<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="book.css" type="text/css" />
</head>
<body>
<h2 id="&#26631;&#20934;&#24211;&#27010;&#35272;-&#31532;ii&#37096;&#20998;">11. &#26631;&#20934;&#24211;&#27010;&#35272; &#8212; &#31532;II&#37096;&#20998;</h2>
<p>&#31532;&#20108;&#37096;&#20998;&#25552;&#20379;&#20102;&#26356;&#39640;&#32423;&#30340;&#27169;&#22359;&#29992;&#26469;&#25903;&#25345;&#19987;&#19994;&#32534;&#31243;&#30340;&#38656;&#35201;&#12290;&#36825;&#20123;&#27169;&#22359;&#24456;&#23569;&#20986;&#29616;&#22312;&#23567;&#22411;&#30340;&#33050;&#26412;&#37324;&#12290;</p>
<h3 id="&#36755;&#20986;&#26684;&#24335;">11.1 &#36755;&#20986;&#26684;&#24335;</h3>
<p><code>reprlib</code>&#27169;&#22359;&#25552;&#20379;&#19968;&#20010;&#23450;&#21046;&#29256;&#30340;<code>repr()</code>&#29992;&#20110;&#26174;&#31034;&#22823;&#22411;&#25110;&#32773;&#28145;&#23618;&#23884;&#22871;&#23481;&#22120;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> reprlib
reprlib.<span class="bu">repr</span>(<span class="bu">set</span>(<span class="st">&#39;supercalifragilisticexpialidocious&#39;</span>))
<span class="co">&quot;set([&#39;a&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, ...])&quot;</span></code></pre></div>
<p><code>pprint</code>&#27169;&#22359;&#25552;&#20379;&#26356;&#22797;&#26434;&#30340;&#25171;&#21360;&#25511;&#21046;&#65292;&#20197;&#35299;&#37322;&#22120;&#21487;&#35835;&#30340;&#26041;&#24335;&#25171;&#21360;&#20986;&#20869;&#32622;&#23545;&#35937;&#21644;&#29992;&#25143;&#23450;&#20041;&#30340;&#23545;&#35937;&#12290;&#24403;&#32467;&#26524;&#36229;&#36807;&#19968;&#34892;&#26102;&#65292;&#36825;&#20010;&quot;&#28418;&#20142;&#30340;&#25171;&#21360;&#26426;&quot;&#23558;&#28155;&#21152;&#20998;&#34892;&#31526;&#21644;&#32553;&#36827;&#65292;&#20197;&#26356;&#28165;&#26970;&#22320;&#26174;&#31034;&#25968;&#25454;&#32467;&#26500;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> pprint
t <span class="op">=</span> [[[[<span class="st">&#39;black&#39;</span>, <span class="st">&#39;cyan&#39;</span>], <span class="st">&#39;white&#39;</span>, [<span class="st">&#39;green&#39;</span>, <span class="st">&#39;red&#39;</span>]], [[<span class="st">&#39;magenta&#39;</span>,
    <span class="st">&#39;yellow&#39;</span>], <span class="st">&#39;blue&#39;</span>]]]

pprint.pprint(t, width<span class="op">=</span><span class="dv">30</span>)
<span class="co">##</span>
[[[[<span class="st">&#39;black&#39;</span>, <span class="st">&#39;cyan&#39;</span>],
   <span class="st">&#39;white&#39;</span>,
   [<span class="st">&#39;green&#39;</span>, <span class="st">&#39;red&#39;</span>]],
  [[<span class="st">&#39;magenta&#39;</span>, <span class="st">&#39;yellow&#39;</span>],
   <span class="co">&#39;blue&#39;</span>]]]</code></pre></div>
<p><code>textwrap</code>&#27169;&#22359;&#26684;&#24335;&#21270;&#25991;&#26412;&#27573;&#33853;&#20197;&#36866;&#24212;&#35774;&#23450;&#30340;&#23631;&#23485;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> textwrap
doc <span class="op">=</span> <span class="st">&quot;&quot;&quot;The wrap() method is just like fill() except that it returns</span>
<span class="st">a list of strings instead of one big string with newlines to separate</span>
<span class="st">the wrapped lines.&quot;&quot;&quot;</span>

<span class="bu">print</span>(textwrap.fill(doc, width<span class="op">=</span><span class="dv">40</span>))
<span class="co">##</span>
The wrap() method <span class="op">is</span> just like fill()
<span class="cf">except</span> that it returns a <span class="bu">list</span> of strings
instead of one big string <span class="cf">with</span> newlines
to separate the wrapped lines.</code></pre></div>
<p><code>locale</code>&#27169;&#22359;&#20250;&#35775;&#38382;&#21306;&#22495;&#24615;&#29305;&#23450;&#25968;&#25454;&#26684;&#24335;&#30340;&#25968;&#25454;&#24211;&#12290;&#20998;&#32452;&#23646;&#24615;&#30340;&#21306;&#22495;&#35774;&#32622;&#30340;&#26684;&#24335;&#20989;&#25968;&#30340;&#26684;&#24335;&#35774;&#32622;&#30340;&#25968;&#23383;&#20197;&#30452;&#25509;&#30340;&#26041;&#24335;&#25552;&#20379;&#20102;&#32452;&#20998;&#38548;&#31526;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> locale
locale.setlocale(locale.LC_ALL, <span class="st">&#39;English_United States.1252&#39;</span>)
<span class="co">## &#39;English_United States.1252&#39;</span>
conv <span class="op">=</span> locale.localeconv()          <span class="co"># get a mapping of conventions</span>
x <span class="op">=</span> <span class="fl">1234567.8</span>
locale.<span class="bu">format</span>(<span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span>, x, grouping<span class="op">=</span><span class="va">True</span>)
<span class="co">## &#39;1,234,567&#39;</span>
locale.format_string(<span class="st">&quot;</span><span class="sc">%s%.*f</span><span class="st">&quot;</span>, (conv[<span class="st">&#39;currency_symbol&#39;</span>],
                     conv[<span class="st">&#39;frac_digits&#39;</span>], x), grouping<span class="op">=</span><span class="va">True</span>)
<span class="co">## &#39;$1,234,567.80&#39;</span></code></pre></div>
<h3 id="&#27169;&#26495;">11.2 &#27169;&#26495;</h3>
<p><code>string</code>&#27169;&#22359;&#21253;&#25324;&#19968;&#20010;&#36890;&#29992;<code>Template</code>&#31867;&#65292;&#23427;&#29992;&#31616;&#21270;&#30340;&#35821;&#27861;&#36866;&#21512;&#26368;&#32456;&#29992;&#25143;&#32534;&#36753;&#12290;&#36825;&#20801;&#35768;&#29992;&#25143;&#33258;&#23450;&#20041;&#20182;&#20204;&#30340;&#24212;&#29992;&#31243;&#24207;&#26080;&#38656;&#20462;&#25913;&#24212;&#29992;&#31243;&#24207;&#12290;</p>
<p>&#36825;&#31181;&#26684;&#24335;&#20351;&#29992;&#30340;&#21344;&#20301;&#31526;&#21517;&#31216;&#30001;<code>$</code>&#19982;&#26377;&#25928;&#30340; Python &#26631;&#35782;&#31526;&#65288;&#23383;&#27597;&#25968;&#23383;&#23383;&#31526;&#21644;&#19979;&#21010;&#32447;&#65289;&#32452;&#25104;&#12290;&#21608;&#22260;&#30340;&#22823;&#25324;&#21495;&#19982;&#21344;&#20301;&#31526;&#20801;&#35768;&#23427;&#24212;&#36981;&#24490;&#30340;&#26356;&#22810;&#23383;&#27597;&#25968;&#23383;&#23383;&#27597;&#24182;&#19988;&#20013;&#38388;&#27809;&#26377;&#31354;&#26684;&#12290;<code>$$</code>&#21019;&#24314;&#19968;&#20010;&#36716;&#20041;&#30340;<code>$</code>&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> string <span class="im">import</span> Template
<span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> Template(<span class="st">&#39;$</span><span class="sc">{village}</span><span class="st">folk send $$10 to $cause.&#39;</span>)
<span class="op">&gt;&gt;&gt;</span> t.substitute(village<span class="op">=</span><span class="st">&#39;Nottingham&#39;</span>, cause<span class="op">=</span><span class="st">&#39;the ditch fund&#39;</span>)
<span class="co">&#39;Nottinghamfolk send $10 to the ditch fund.&#39;</span></code></pre></div>
<p>&#24403;&#23383;&#20856;&#25110;&#20851;&#38190;&#23383;&#21442;&#25968;&#20013;&#27809;&#26377;&#25552;&#20379;&#21344;&#20301;&#31526;&#26102;&#65292;<code>substitute()</code>&#26041;&#27861;&#23558;&#24341;&#21457;<code>KeyError</code>&#12290;&#23545;&#20110;&#37038;&#20214;-&#21512;&#24182;&#39118;&#26684;&#30340;&#24212;&#29992;&#31243;&#24207;&#65292;&#29992;&#25143;&#25552;&#20379;&#30340;&#25968;&#25454;&#21487;&#33021;&#19981;&#23436;&#25972;&#65292;&#36825;&#26102;<code>safe_substitute()</code>&#26041;&#27861;&#21487;&#33021;&#20250;&#26356;&#21512;&#36866; &#8212;&#8212; &#22914;&#26524;&#27809;&#26377;&#25968;&#25454;&#23427;&#23558;&#20445;&#25345;&#21344;&#20301;&#31526;&#19981;&#21464;&#65306;</p>
<pre class="pyhton"><code>&gt;&gt;&gt; t = Template(&#39;Return the $item to $owner.&#39;)
&gt;&gt;&gt; d = dict(item=&#39;unladen swallow&#39;)
&gt;&gt;&gt; t.substitute(d)
Traceback (most recent call last):
  ...
KeyError: &#39;owner&#39;
&gt;&gt;&gt; t.safe_substitute(d)
&#39;Return the unladen swallow to $owner.&#39;</code></pre>
<p>Template &#31867;&#30340;&#23376;&#31867;&#21487;&#20197;&#25351;&#23450;&#33258;&#23450;&#20041;&#30340;&#20998;&#38548;&#31526;&#12290;&#20363;&#22914;&#65292;&#22270;&#20687;&#27983;&#35272;&#22120;&#30340;&#25209;&#37327;&#21629;&#21517;&#24037;&#20855;&#21487;&#33021;&#36873;&#29992;&#30334;&#20998;&#21495;&#20316;&#20026;&#34920;&#31034;&#24403;&#21069;&#26085;&#26399;&#12289;&#22270;&#20687; &#24207;&#21015;&#21495;&#25110;&#25991;&#20214;&#26684;&#24335;&#30340;&#21344;&#20301;&#31526;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> time, os.path
<span class="op">&gt;&gt;&gt;</span> photofiles <span class="op">=</span> [<span class="st">&#39;img_1074.jpg&#39;</span>, <span class="st">&#39;img_1076.jpg&#39;</span>, <span class="st">&#39;img_1077.jpg&#39;</span>]
<span class="op">&gt;&gt;&gt;</span> <span class="kw">class</span> BatchRename(Template):
...     delimiter <span class="op">=</span> <span class="st">&#39;%&#39;</span>
<span class="op">&gt;&gt;&gt;</span> fmt <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;Enter rename style (</span><span class="sc">%d</span><span class="st">-date %n-seqnum </span><span class="sc">%f</span><span class="st">-format):  &#39;</span>)
Enter rename style (<span class="op">%</span>d<span class="op">-</span>date <span class="op">%</span>n<span class="op">-</span>seqnum <span class="op">%</span>f<span class="op">-</span><span class="bu">format</span>):  Ashley_<span class="op">%</span>n<span class="op">%</span>f

<span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> BatchRename(fmt)
<span class="op">&gt;&gt;&gt;</span> date <span class="op">=</span> time.strftime(<span class="st">&#39;</span><span class="sc">%d</span><span class="st">%b%y&#39;</span>)
<span class="op">&gt;&gt;&gt;</span> <span class="cf">for</span> i, filename <span class="op">in</span> <span class="bu">enumerate</span>(photofiles):
...     base, ext <span class="op">=</span> os.path.splitext(filename)
...     newname <span class="op">=</span> t.substitute(d<span class="op">=</span>date, n<span class="op">=</span>i, f<span class="op">=</span>ext)
...     <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{0}</span><span class="st"> --&gt; </span><span class="sc">{1}</span><span class="st">&#39;</span>.<span class="bu">format</span>(filename, newname))

img_1074.jpg <span class="op">--&gt;</span> Ashley_0.jpg
img_1076.jpg <span class="op">--&gt;</span> Ashley_1.jpg
img_1077.jpg <span class="op">--&gt;</span> Ashley_2.jpg</code></pre></div>
<p>&#27169;&#26495;&#30340;&#21478;&#19968;&#20010;&#24212;&#29992;&#26159;&#25226;&#22810;&#26679;&#30340;&#36755;&#20986;&#26684;&#24335;&#32454;&#33410;&#20174;&#31243;&#24207;&#36923;&#36753;&#20013;&#20998;&#31867;&#20986;&#26469;&#12290;&#36825;&#20351;&#23427;&#33021;&#22815;&#26367;&#20195;&#29992;&#25143;&#30340; XML &#25991;&#20214;&#12289; &#32431;&#25991;&#26412;&#25253;&#21578;&#21644; HTML &#32593;&#39029;&#25253;&#34920;&#12290;</p>
<h3 id="&#20108;&#36827;&#21046;&#25968;&#25454;&#35760;&#24405;&#26684;&#24335;">11.3 &#20108;&#36827;&#21046;&#25968;&#25454;&#35760;&#24405;&#26684;&#24335;</h3>
<p>The struct module provides <code>pack()</code> and <code>unpack()</code> functions for working with variable length binary record formats. The following example shows how to loop through header information in a ZIP file without using the zipfile module. Pack codes &quot;H&quot; and &quot;I&quot; represent two and four byte unsigned numbers respectively. The &quot;&lt;&quot; indicates that they are standard size and in little-endian byte order:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> struct

<span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;myfile.zip&#39;</span>, <span class="st">&#39;rb&#39;</span>) <span class="im">as</span> f:
    data <span class="op">=</span> f.read()

start <span class="op">=</span> <span class="dv">0</span>
<span class="cf">for</span> i <span class="op">in</span> <span class="bu">range</span>(<span class="dv">3</span>):                      <span class="co"># show the first 3 file headers</span>
    start <span class="op">+=</span> <span class="dv">14</span>
    fields <span class="op">=</span> struct.unpack(<span class="st">&#39;&lt;IIIHH&#39;</span>, data[start:start<span class="dv">+16</span>])
    crc32, comp_size, uncomp_size, filenamesize, extra_size <span class="op">=</span> fields

    start <span class="op">+=</span> <span class="dv">16</span>
    filename <span class="op">=</span> data[start:start<span class="op">+</span>filenamesize]
    start <span class="op">+=</span> filenamesize
    extra <span class="op">=</span> data[start:start<span class="op">+</span>extra_size]
    <span class="bu">print</span>(filename, <span class="bu">hex</span>(crc32), comp_size, uncomp_size)

    start <span class="op">+=</span> extra_size <span class="op">+</span> comp_size     <span class="co"># skip to the next header</span></code></pre></div>
<h3 id="&#22810;&#32447;&#31243;">11.4. &#22810;&#32447;&#31243;</h3>
<p>&#32447;&#31243;&#26159;&#19968;&#31181;&#35299;&#32806;&#38750;&#39034;&#24207;&#20381;&#36182;&#20219;&#21153;&#30340;&#25216;&#26415;&#12290;&#32447;&#31243;&#21487;&#20197;&#29992;&#26469;&#25552;&#39640;&#25509;&#24212;&#29992;&#31243;&#24207;&#21463;&#29992;&#25143;&#36755;&#20837;&#30340;&#21709;&#24212;&#36895;&#24230;&#65292;&#32780;&#20854;&#20182;&#20219;&#21153;&#21516;&#26102;&#22312;&#21518;&#21488;&#36816;&#34892;&#12290;&#19968;&#20010;&#30456;&#20851;&#30340;&#20351;&#29992;&#22330;&#26223;&#26159; I/O &#25805;&#20316;&#19982;&#21478;&#19968;&#20010;&#32447;&#31243;&#20013;&#30340;&#35745;&#31639;&#24182;&#34892;&#25191;&#34892;&#12290;</p>
<p>&#19979;&#38754;&#30340;&#20195;&#30721;&#28436;&#31034;&#22312;&#20027;&#31243;&#24207;&#36830;&#32493;&#36816;&#34892;&#30340;&#21516;&#26102;&#65292;<code>threading</code>&#27169;&#22359;&#22914;&#20309;&#22312;&#21518;&#21488;&#36816;&#34892;&#20219;&#21153;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> threading, zipfile

<span class="kw">class</span> AsyncZip(threading.Thread):
    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, infile, outfile):
        threading.Thread.<span class="fu">__init__</span>(<span class="va">self</span>)
        <span class="va">self</span>.infile <span class="op">=</span> infile
        <span class="va">self</span>.outfile <span class="op">=</span> outfile
    <span class="kw">def</span> run(<span class="va">self</span>):
        f <span class="op">=</span> zipfile.ZipFile(<span class="va">self</span>.outfile, <span class="st">&#39;w&#39;</span>, zipfile.ZIP_DEFLATED)
        f.write(<span class="va">self</span>.infile)
        f.close()
        <span class="bu">print</span>(<span class="st">&#39;Finished background zip of:&#39;</span>, <span class="va">self</span>.infile)

background <span class="op">=</span> AsyncZip(<span class="st">&#39;mydata.txt&#39;</span>, <span class="st">&#39;myarchive.zip&#39;</span>)
background.start()
<span class="bu">print</span>(<span class="st">&#39;The main program continues to run in foreground.&#39;</span>)

background.join()    <span class="co"># Wait for the background task to finish</span>
<span class="bu">print</span>(<span class="st">&#39;Main program waited until background was done.&#39;</span>)</code></pre></div>
<p>&#22810;&#32447;&#31243;&#24212;&#29992;&#31243;&#24207;&#30340;&#26368;&#20027;&#35201;&#25361;&#25112;&#26159;&#21327;&#35843;&#32447;&#31243;&#38388;&#20849;&#20139;&#30340;&#25968;&#25454;&#25110;&#20854;&#20182;&#36164;&#28304;&#12290;&#20026;&#27492;&#30446;&#30340;&#65292;&#35813;&#32447;&#31243;&#27169;&#22359;&#25552;&#20379;&#20102;&#35768;&#22810;&#21516;&#27493;&#21407;&#35821;&#21253;&#25324;&#38145;&#12289; &#20107;&#20214;&#12289; &#26465;&#20214;&#21464;&#37327;&#21644;&#20449;&#21495;&#37327;&#12290;</p>
<p>&#23613;&#31649;&#36825;&#20123;&#24037;&#20855;&#24456;&#24378;&#22823;&#65292;&#24456;&#23567;&#30340;&#35774;&#35745;&#38169;&#35823;&#20063;&#21487;&#33021;&#23548;&#33268;&#24456;&#38590;&#22797;&#29616;&#30340;&#38382;&#39064;&#12290;&#22240;&#27492;&#65292;&#20219;&#21153;&#21327;&#35843;&#30340;&#39318;&#36873;&#26041;&#27861;&#26159;&#25226;&#23545;&#19968;&#20010;&#36164;&#28304;&#30340;&#25152;&#26377;&#35775;&#38382;&#38598;&#20013;&#22312;&#19968;&#20010;&#21333;&#29420;&#30340;&#32447;&#31243;&#20013;&#65292;&#28982;&#21518;&#20351;&#29992;<code>queue</code>&#27169;&#22359;&#29992;&#37027;&#20010;&#32447;&#31243;&#26381;&#21153;&#20854;&#20182;&#32447;&#31243;&#30340;&#35831;&#27714;&#12290;&#24212;&#29992;&#31243;&#24207;&#20351;&#29992;<code>Queue</code>&#23545;&#35937;&#36827;&#34892;&#32447;&#31243;&#38388;&#30340;&#36890;&#20449;&#21644;&#21327;&#35843;&#23558;&#26356;&#23481;&#26131;&#35774;&#35745;&#12289; &#26356;&#20855;&#21487;&#35835;&#24615;&#21644;&#26356;&#21487;&#38752;&#12290;</p>
<h3 id="&#26085;&#24535;">11.5 &#26085;&#24535;</h3>
<p><code>logging</code>&#27169;&#22359;&#25552;&#20379;&#20102;&#19968;&#20010;&#20855;&#26377;&#23436;&#25972;&#21151;&#33021;&#24182;&#19988;&#38750;&#24120;&#28789;&#27963;&#30340;&#26085;&#24535;&#31995;&#32479;&#12290;&#26368;&#31616;&#21333;&#30340;&#65292;&#21457;&#36865;&#28040;&#24687;&#21040;&#19968;&#20010;&#25991;&#20214;&#25110;&#32773;<code>sys.stderr</code>&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> logging
logging.debug(<span class="st">&#39;Debugging information&#39;</span>)
logging.info(<span class="st">&#39;Informational message&#39;</span>)
logging.warning(<span class="st">&#39;Warning:config file </span><span class="sc">%s</span><span class="st"> not found&#39;</span>, <span class="st">&#39;server.conf&#39;</span>)
logging.error(<span class="st">&#39;Error occurred&#39;</span>)
logging.critical(<span class="st">&#39;Critical error -- shutting down&#39;</span>)</code></pre></div>
<p>&#36825;&#23558;&#29983;&#25104;&#20197;&#19979;&#36755;&#20986;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">WARNING:root:<span class="pp">Warning</span>:config <span class="bu">file</span> server.conf <span class="op">not</span> found
ERROR:root:Error occurred
CRITICAL:root:Critical error <span class="op">--</span> shutting down</code></pre></div>
<p>&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#20449;&#24687;&#21644;&#35843;&#35797;&#28040;&#24687;&#34987;&#21387;&#21046;&#24182;&#36755;&#20986;&#21040;&#26631;&#20934;&#38169;&#35823;&#12290;&#20854;&#20182;&#36755;&#20986;&#36873;&#39033;&#21253;&#25324;&#23558;&#28040;&#24687;&#36890;&#36807;<code>email&#12289; datagrams&#12289;sockets</code>&#21457;&#36865;&#65292;&#25110;&#32773;&#21457;&#36865;&#21040; HTTP &#26381;&#21153;&#22120;&#12290;&#26681;&#25454;&#28040;&#24687;&#30340;&#20248;&#20808;&#32423;&#65292;&#26032;&#30340;&#36807;&#28388;&#22120;&#21487;&#20197;&#36873;&#25321;&#19981;&#21516;&#30340;&#26041;&#24335;&#65306;<code>DEBUG&#12289;INFO&#12289;WARNING&#12289;ERROR&#21644;CRITICAL</code>&#12290;</p>
<p>&#26085;&#24535;&#31995;&#32479;&#21487;&#20197;&#30452;&#25509;&#22312; Python &#20195;&#30721;&#20013;&#23450;&#21046;&#65292;&#20063;&#21487;&#20197;&#19981;&#32463;&#36807;&#24212;&#29992;&#31243;&#24207;&#30452;&#25509;&#22312;&#19968;&#20010;&#29992;&#25143;&#21487;&#32534;&#36753;&#30340;&#37197;&#32622;&#25991;&#20214;&#20013;&#21152;&#36733;&#12290;</p>
<h3 id="&#24369;&#24341;&#29992;">11.6 &#24369;&#24341;&#29992;</h3>
<p>Python &#20250;&#33258;&#21160;&#36827;&#34892;&#20869;&#23384;&#31649;&#29702; (&#23545;&#22823;&#22810;&#25968;&#30340;&#23545;&#35937;&#36827;&#34892;&#24341;&#29992;&#35745;&#25968;&#21644;&#22403;&#22334;&#22238;&#25910;&#20197;&#24490;&#29615;&#21033;&#29992;&#65289;&#12290;&#22312;&#26368;&#21518;&#19968;&#20010;&#24341;&#29992;&#28040;&#22833;&#21518;&#65292;&#20869;&#23384;&#20250;&#31435;&#21363;&#37322;&#25918;&#12290;</p>
<p>&#36825;&#20010;&#26041;&#24335;&#23545;&#22823;&#22810;&#25968;&#24212;&#29992;&#31243;&#24207;&#24037;&#20316;&#33391;&#22909;&#65292;&#20294;&#26159;&#26377;&#26102;&#20505;&#20250;&#38656;&#35201;&#36319;&#36394;&#23545;&#35937;&#65292;&#21482;&#35201;&#23427;&#20204;&#36824;&#34987;&#20854;&#23427;&#22320;&#26041;&#25152;&#20351;&#29992;&#12290;&#19981;&#24184;&#30340;&#26159;&#65292;&#21482;&#26159;&#36319;&#36394;&#23427;&#20204;&#20063;&#20250;&#21019;&#24314;&#19968;&#20010;&#24341;&#29992;&#65292;&#36825;&#23558;&#20351;&#23427;&#20204;&#27704;&#20037;&#20445;&#30041;&#12290;<code>weakref</code>&#27169;&#22359;&#25552;&#20379;&#24037;&#20855;&#29992;&#26469;&#26080;&#38656;&#21019;&#24314;&#19968;&#20010;&#24341;&#29992;&#36319;&#36394;&#23545;&#35937;&#12290;&#24403;&#19981;&#20877;&#38656;&#35201;&#35813;&#23545;&#35937;&#26102;&#65292;&#23427;&#20250;&#33258;&#21160;&#20174; <code>weakref</code> &#34920;&#20013;&#21024;&#38500;&#24182;&#19988;&#20250;&#20026; <code>weakref</code> &#23545;&#35937;&#35302;&#21457;&#19968;&#20010;&#22238;&#35843;&#12290;&#20856;&#22411;&#30340;&#24212;&#29992;&#21253;&#25324;&#32531;&#23384;&#21019;&#24314;&#30340;&#26102;&#20505;&#38656;&#35201;&#24456;&#22823;&#24320;&#38144;&#30340;&#23545;&#35937;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> weakref, gc
<span class="op">&gt;&gt;&gt;</span> <span class="kw">class</span> A:
...     <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, value):
...         <span class="va">self</span>.value <span class="op">=</span> value
...     <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>):
...         <span class="cf">return</span> <span class="bu">str</span>(<span class="va">self</span>.value)
...
<span class="op">&gt;&gt;&gt;</span> a <span class="op">=</span> A(<span class="dv">10</span>)                   <span class="co"># create a reference</span>
<span class="op">&gt;&gt;&gt;</span> d <span class="op">=</span> weakref.WeakValueDictionary()
<span class="op">&gt;&gt;&gt;</span> d[<span class="st">&#39;primary&#39;</span>] <span class="op">=</span> a            <span class="co"># does not create a reference</span>
<span class="op">&gt;&gt;&gt;</span> d[<span class="st">&#39;primary&#39;</span>]                <span class="co"># fetch the object if it is still alive</span>
<span class="dv">10</span>
<span class="op">&gt;&gt;&gt;</span> <span class="kw">del</span> a                       <span class="co"># remove the one reference</span>
<span class="op">&gt;&gt;&gt;</span> gc.collect()                <span class="co"># run garbage collection right away</span>
<span class="dv">0</span>
<span class="op">&gt;&gt;&gt;</span> d[<span class="st">&#39;primary&#39;</span>]                <span class="co"># entry was automatically removed</span>
Traceback (most recent call last):
  File <span class="st">&quot;&lt;stdin&gt;&quot;</span>, line <span class="dv">1</span>, <span class="op">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span>
    d[<span class="st">&#39;primary&#39;</span>]                <span class="co"># entry was automatically removed</span>
  File <span class="st">&quot;C:/python34/lib/weakref.py&quot;</span>, line <span class="dv">46</span>, <span class="op">in</span> <span class="fu">__getitem__</span>
    o <span class="op">=</span> <span class="va">self</span>.data[key]()
<span class="pp">KeyError</span>: <span class="st">&#39;primary&#39;</span></code></pre></div>
<h3 id="&#21015;&#34920;&#24037;&#20855;">11.7 &#21015;&#34920;&#24037;&#20855;</h3>
<p>&#24456;&#22810;&#25968;&#25454;&#32467;&#26500;&#20351;&#29992;&#20869;&#32622;&#21015;&#34920;&#31867;&#22411;&#23601;&#21487;&#20197;&#28385;&#36275;&#38656;&#27714;&#12290;&#28982;&#32780;&#65292;&#26377;&#26102;&#38656;&#35201;&#20854;&#23427;&#20855;&#26377;&#19981;&#21516;&#24615;&#33021;&#30340;&#26367;&#20195;&#23454;&#29616;&#12290; The array module provides an <code>array()</code> object that is like a list that stores only homogeneous data and stores it more compactly. The following example shows an array of numbers stored as two byte unsigned binary numbers (typecode &quot;H&quot;) rather than the usual 16 bytes per entry for regular lists of Python int objects:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> array <span class="im">import</span> array
<span class="op">&gt;&gt;&gt;</span> a <span class="op">=</span> array(<span class="st">&#39;H&#39;</span>, [<span class="dv">4000</span>, <span class="dv">10</span>, <span class="dv">700</span>, <span class="dv">22222</span>])
<span class="op">&gt;&gt;&gt;</span> <span class="bu">sum</span>(a)
<span class="dv">26932</span>
<span class="op">&gt;&gt;&gt;</span> a[<span class="dv">1</span>:<span class="dv">3</span>]
array(<span class="st">&#39;H&#39;</span>, [<span class="dv">10</span>, <span class="dv">700</span>])</code></pre></div>
<p><code>collections</code>&#27169;&#22359;&#25552;&#20379;&#20102;&#19968;&#20010;<code>deque()</code>&#23545;&#35937;&#65292;&#23601;&#20687;&#19968;&#20010;&#21015;&#34920;,&#19981;&#36807;&#23427;&#20174;&#24038;&#36793;&#28155;&#21152;&#21644;&#24377;&#20986;&#26356;&#24555;&#65292;&#20294;&#26159;&#22312;&#20869;&#37096;&#26597;&#35810;&#26356;&#24930;&#12290;&#36825;&#20123;&#23545;&#35937;&#38750;&#24120;&#23454;&#29616;&#38431;&#21015;&#21644;&#24191;&#24230;&#20248;&#20808;&#30340;&#26641;&#25628;&#32034;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> collections <span class="im">import</span> deque
<span class="op">&gt;&gt;&gt;</span> d <span class="op">=</span> deque([<span class="st">&quot;task1&quot;</span>, <span class="st">&quot;task2&quot;</span>, <span class="st">&quot;task3&quot;</span>])
<span class="op">&gt;&gt;&gt;</span> d.append(<span class="st">&quot;task4&quot;</span>)
<span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(<span class="st">&quot;Handling&quot;</span>, d.popleft())
Handling task1

unsearched <span class="op">=</span> deque([starting_node])
<span class="kw">def</span> breadth_first_search(unsearched):
    node <span class="op">=</span> unsearched.popleft()
    <span class="cf">for</span> m <span class="op">in</span> gen_moves(node):
        <span class="cf">if</span> is_goal(m):
            <span class="cf">return</span> m
        unsearched.append(m)</code></pre></div>
<p>&#38500;&#20102;&#21015;&#34920;&#30340;&#26367;&#20195;&#23454;&#29616;&#65292;&#35813;&#24211;&#36824;&#25552;&#20379;&#20102;&#20854;&#23427;&#24037;&#20855;&#20363;&#22914;<code>bisect</code>&#27169;&#22359;&#20013;&#21253;&#21547;&#22788;&#29702;&#25490;&#22909;&#24207;&#30340;&#21015;&#34920;&#30340;&#20989;&#25968;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> bisect
<span class="op">&gt;&gt;&gt;</span> scores <span class="op">=</span> [(<span class="dv">100</span>, <span class="st">&#39;perl&#39;</span>), (<span class="dv">200</span>, <span class="st">&#39;tcl&#39;</span>), (<span class="dv">400</span>, <span class="st">&#39;lua&#39;</span>), (<span class="dv">500</span>, <span class="st">&#39;python&#39;</span>)]
<span class="op">&gt;&gt;&gt;</span> bisect.insort(scores, (<span class="dv">300</span>, <span class="st">&#39;ruby&#39;</span>))
<span class="op">&gt;&gt;&gt;</span> scores
[(<span class="dv">100</span>, <span class="st">&#39;perl&#39;</span>), (<span class="dv">200</span>, <span class="st">&#39;tcl&#39;</span>), (<span class="dv">300</span>, <span class="st">&#39;ruby&#39;</span>), (<span class="dv">400</span>, <span class="st">&#39;lua&#39;</span>), (<span class="dv">500</span>, <span class="st">&#39;python&#39;</span>)]</code></pre></div>
<p><code>heapq</code>&#27169;&#22359;&#25552;&#20379;&#30340;&#20989;&#25968;&#21487;&#20197;&#23454;&#29616;&#22522;&#20110;&#24120;&#35268;&#21015;&#34920;&#30340;&#22534;&#12290;&#26368;&#23567;&#30340;&#20540;&#24635;&#26159;&#20445;&#25345;&#22312;&#31532;&#38646;&#20010;&#20301;&#32622;&#12290;&#36825;&#23545;&#24490;&#29615;&#35775;&#38382;&#26368;&#23567;&#20803;&#32032;&#65292;&#20294;&#26159;&#19981;&#24819;&#36816;&#34892;&#23436;&#25972;&#21015;&#34920;&#25490;&#24207;&#30340;&#24212;&#29992;&#38750;&#24120;&#26377;&#29992;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> heapq <span class="im">import</span> heapify, heappop, heappush
<span class="op">&gt;&gt;&gt;</span> data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">0</span>]
<span class="op">&gt;&gt;&gt;</span> heapify(data)                      <span class="co"># rearrange the list into heap order</span>
<span class="op">&gt;&gt;&gt;</span> heappush(data, <span class="op">-</span><span class="dv">5</span>)                 <span class="co"># add a new entry</span>
<span class="op">&gt;&gt;&gt;</span> [heappop(data) <span class="cf">for</span> i <span class="op">in</span> <span class="bu">range</span>(<span class="dv">3</span>)]  <span class="co"># fetch the three smallest entries</span>
[<span class="op">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>]</code></pre></div>
<h3 id="&#21313;&#36827;&#21046;&#28014;&#28857;&#25968;&#36816;&#31639;">11.8. &#21313;&#36827;&#21046;&#28014;&#28857;&#25968;&#36816;&#31639;</h3>
<p><code>decimal</code>&#27169;&#22359;&#25552;&#20379;&#19968;&#20010;<code>Decimal</code>&#25968;&#25454;&#31867;&#22411;&#29992;&#20110;&#20026;&#21313;&#36827;&#21046;&#28014;&#28857;&#36816;&#31639;&#12290;&#30456;&#27604;&#20108;&#36827;&#21046;&#28014;&#28857;&#25968;&#20869;&#32622;&#30340;float&#23454;&#29616;&#65292;&#36825;&#20010;&#31867;&#23545;&#20110;&#20197;&#19979;&#24773;&#24418;&#29305;&#21035;&#26377;&#29992;&#65306;</p>
<ul>
<li>&#36130;&#21153;&#24212;&#29992;&#31243;&#24207;&#21644;&#20854;&#20182;&#29992;&#36884;&#65292;&#38656;&#35201;&#31934;&#30830;&#30340;&#21313;&#36827;&#21046;&#34920;&#31034;&#24418;&#24335;&#65292;</li>
<li>&#25511;&#21046;&#31934;&#24230;&#65292;</li>
<li>&#23545;&#31526;&#21512;&#27861;&#24459;&#25110;&#27861;&#35268;&#35201;&#27714;&#65292;&#33293;&#20837;&#30340;&#25511;&#21046;</li>
<li>&#36319;&#36394;&#26377;&#25928;&#23567;&#25968;&#20301;</li>
<li>&#29992;&#25143;&#24076;&#26395;&#35745;&#31639;&#32467;&#26524;&#19982;&#25163;&#24037;&#35745;&#31639;&#30456;&#31526;&#30340;&#24212;&#29992;&#31243;&#24207;&#12290;</li>
</ul>
<p>&#20363;&#22914;&#65292;&#35745;&#31639;&#19978; 70%&#30005;&#35805;&#36153;&#30340; 5%&#31246;&#32473;&#19981;&#21516;&#30340;&#21313;&#36827;&#21046;&#28014;&#28857;&#21644;&#20108;&#36827;&#21046;&#28014;&#28857;&#32467;&#26524;&#12290;&#21306;&#21035;&#21464;&#24471;&#26126;&#26174;&#22914;&#26524;&#32467;&#26524;&#33293;&#20837;&#21040;&#26368;&#25509;&#36817;&#30340;&#20998;:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> decimal <span class="im">import</span> <span class="op">*</span>
<span class="op">&gt;&gt;&gt;</span> <span class="bu">round</span>(Decimal(<span class="st">&#39;0.70&#39;</span>) <span class="op">*</span> Decimal(<span class="st">&#39;1.05&#39;</span>), <span class="dv">2</span>)
Decimal(<span class="st">&#39;0.74&#39;</span>)
<span class="op">&gt;&gt;&gt;</span> <span class="bu">round</span>(.<span class="dv">70</span> <span class="op">*</span> <span class="fl">1.05</span>, <span class="dv">2</span>)
<span class="fl">0.73</span></code></pre></div>
<p><code>Decimal</code>&#30340;&#32467;&#26524;&#24635;&#26159;&#20445;&#26377;&#32467;&#23614;&#30340;0&#65292;&#33258;&#21160;&#20174;&#20004;&#20301;&#31934;&#24230;&#24310;&#20280;&#21040;4&#20301;&#12290;<code>Decimal</code> &#31867;&#20284;&#25163;&#24037;&#23436;&#25104;&#30340;&#25968;&#23398;&#36816;&#31639;&#65292;&#36825;&#23601;&#36991;&#20813;&#20102;&#20108;&#36827;&#21046;&#28014;&#28857;&#25968;&#26080;&#27861;&#31934;&#30830;&#34920;&#36798;&#25968;&#25454;&#31934;&#24230;&#20135;&#29983;&#30340;&#38382;&#39064;&#12290;</p>
<p>&#31934;&#30830;&#22320;&#34920;&#31034;&#20801;&#35768;<code>Decimal</code>&#21487;&#20197;&#25191;&#34892;&#20108;&#36827;&#21046;&#28014;&#28857;&#25968;&#26080;&#27861;&#36827;&#34892;&#30340;&#27169;&#36816;&#31639;&#21644;&#31561;&#20540;&#27979;&#35797;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> Decimal(<span class="st">&#39;1.00&#39;</span>) <span class="op">%</span> Decimal(<span class="st">&#39;.10&#39;</span>)
Decimal(<span class="st">&#39;0.00&#39;</span>)
<span class="op">&gt;&gt;&gt;</span> <span class="fl">1.00</span> <span class="op">%</span> <span class="fl">0.10</span>
<span class="fl">0.09999999999999995</span>

<span class="op">&gt;&gt;&gt;</span> <span class="bu">sum</span>([Decimal(<span class="st">&#39;0.1&#39;</span>)]<span class="op">*</span><span class="dv">10</span>) <span class="op">==</span> Decimal(<span class="st">&#39;1.0&#39;</span>)
<span class="va">True</span>
<span class="op">&gt;&gt;&gt;</span> <span class="bu">sum</span>([<span class="fl">0.1</span>]<span class="op">*</span><span class="dv">10</span>) <span class="op">==</span> <span class="fl">1.0</span>
<span class="va">False</span></code></pre></div>
<p><code>decimal</code>&#27169;&#22359;&#25552;&#20379;&#20219;&#24847;&#31934;&#24230;&#30340;&#36816;&#31639;&#65306;</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> getcontext().prec <span class="op">=</span> <span class="dv">36</span>
<span class="op">&gt;&gt;&gt;</span> Decimal(<span class="dv">1</span>) <span class="op">/</span> Decimal(<span class="dv">7</span>)
Decimal(<span class="st">&#39;0.142857142857142857142857142857142857&#39;</span>)</code></pre></div>
</body>
</html>
